(function(n,t){t(["./kendo.grid"],n)})(function(){return function(n,t){var i=window.kendo,f=i.ui,r=i.ui.Grid,l=n.extend,s=n.proxy,u="k-state-disabled",e=".kendoGrid",o="click",h=["kendoComboBox","kendoDatePicker","kendoDateTimePicker","kendoDropDownList","kendoMaskedTextBox","kendoNumericTextBox","kendoMultiSelect"],c;l(f,{enable:function(i,r){r=r===t?!0:r;n(h).each(function(){if(i.data()[this]){i.data()[this].enable(r);return}});i.attr("disabled",!r)},readonly:function(i,r){r=r===t?!0:r;n(h).each(function(){if(i.data()[this]){i.data()[this].readonly(r);return}});i.attr("readonly",r)}},!0);c=r.extend({init:function(t,i){var u=this;n(i.columns).each(function(){var t=this,f=t.foreign,e=i.filterable,r;f&&(r=f.mode||"key",r=="key"?(n.extend(!0,t,u._createForeignKeyColumn(t)),e&&e.mode=="row"&&(i.autoBind=!1)):r=="collection"&&n.extend(!0,t,u._createForeignCollectionColumn(t)))});i.name="Grid";r.fn.init.call(u,t,i)},options:{name:"EditableGrid",scrollable:!1,sortable:!0,filterable:!0,selectable:!0,pageable:{refresh:!0,pageSizes:!0},toolbar:["title","separator","create","edit","destroy","update","canceledit"],editable:"popup",dataBound:function(){this._enableToolbar(this.select().length>0)},change:function(){this._enableToolbar(this.select().length>0)},edit:function(t){var i=this;t.model.isNew()||n('[name="Id"]').attr("readonly",!0);n(i.options.columns).each(function(){this.disabled&&f.enable(n('[name="'+this.field+'"]'),!1);this.readonly&&f.readonly(n('[name="'+this.field+'"]'))})},save:function(t){var u=this,i=t.model,r=i.isNew();n(u.options.columns).each(function(n,u){var f=u.field,c,s;if(u.foreign){var f=this.field,e=u.foreign,o=e.mode||"key",h=e.dataValueField||"Id";o=="key"?(c=e.entity||f.replace("Id",""),r&&!i[f]&&(s=t.container.find("input[name="+f+"]").data("kendoDropDownList").dataItem(),i[f]=s&&s[h]||null)):o=="entity"?(r&&!i[f]&&(i[f]=t.container.find("input[name="+f+"]").data("kendoDropDownList").dataItem()),i[f+"Id"]=i[f]?i[f].Id:null):o=="collection"}})}},_toolbar:function(){var t=this,h=t.options.toolbar,f=t.options.editable,i;if(r.fn._toolbar.call(t),h&&(i=t.wrapper.find(".k-grid-toolbar"),f&&f.create!==!1)){i.on(o+e,".k-grid-edit",function(){t.editRow(t.select())}).on(o+e,".k-grid-delete",function(i){n(i.target).hasClass(u)||t.removeRow(t.select())});i.find(".k-grid-update").hide();i.find(".k-grid-cancel").hide();this._editCancelClickHandler||(this._editCancelClickHandler=s(this._editCancelClick,this));i.on(o+e,"a.k-grid-cancel",this._editCancelClickHandler);this._editUpdateClickHandler||(this._editUpdateClickHandler=s(this._editUpdateClick,this));i.on(o+e,"a.k-grid-update",this._editUpdateClickHandler)}},_createButton:function(n){var t=this,i;return n=="title"?(i=t.options.title||"","<span class='k-title k-widget k-state-selected'>"+i+"<\/span>"):n=="separator"?"<span class='k-separator'><\/span>":r.fn._createButton.call(t,n)},_createInlineEditor:function(n,t){var u=this,f=u.options.toolbar,i;r.fn._createInlineEditor.call(u,n,t);f&&(i=u.wrapper.find(".k-grid-toolbar"),i.find(".k-grid-edit").hide(),i.find(".k-grid-delete").hide(),i.find(".k-grid-update").show(),i.find(".k-grid-cancel").show())},_destroyEditView:function(){var t=this,i=t.options.toolbar,n;r.fn._destroyEditView.call(t);i&&(n=t.wrapper.find(".k-grid-toolbar"),n.find(".k-grid-update").hide(),n.find(".k-grid-cancel").hide(),n.find(".k-grid-edit").show(),n.find(".k-grid-delete").show())},_enableToolbar:function(n){var i=this,r=i.options.toolbar,t;r&&(t=i.wrapper.find(".k-grid-toolbar"),typeof n=="undefined"&&(n=!0),n?(t.find(".k-grid-edit").removeClass(u),t.find(".k-grid-delete").removeClass(u)):(t.find(".k-grid-edit").addClass(u),t.find(".k-grid-delete").addClass(u)))},_createForeignKeyColumn:function(t){function e(t,r,u){var e=r.field,f=r.foreign,c=f.entity||e.replace("Id",""),o=f.dataTextField||"Name",s=f.dataValueField||"Id",h=i.format("#={0} ? {1} : '<空>'#",s,o),l=f.url||"/odata/"+c,a=f.expand||"?$select=Id,Name";return u=n.extend(!0,{valuePrimitive:!0,filter:"startswith",dataTextField:o,dataValueField:s,optionLabel:{Id:null},dataSource:{type:"odata-v4",serverFiltering:!0,serverSorting:!0,transport:{read:l+a},sort:{field:o}},template:h,valueTemplate:h,value:sessionStorage.getItem(e),change:function(){var n=this.value();sessionStorage.getItem(e)!=n&&sessionStorage.setItem(e,n)}},u),t.kendoDropDownList(u)}var u=t.field,r=t.foreign,f=r.entity||u.replace("Id",""),s=r.required&&"required"||"",h=r.dataTextField||"Name",o=r.dataValueField||"Id";return n.extend(!0,{width:200,editor:function(r,h){var c=h.model,l=n('<input name="'+u+'" data-bind="value:'+u+'" '+s+"/>").appendTo(r),a=e(l,t,{dataBound:function(){var t=this,n;c.isNew()&&(n=t.dataItem(),c[f]=n&&n[o]?n:null,t.trigger("change"))}}).data("kendoDropDownList");n.extend(!0,a,{_change:function(){var t=this,n=t.dataItem();c[f]=n&&n[o]?n:null;i.ui.DropDownList.fn._change.call(t)}})},template:i.format("#=typeof({0}) != 'undefined' && {0} ? {0}.{1} : ''#",f,h),filterable:{ui:function(n){e(n,t)},cell:{template:function(n){e(n.element,t,{dataBound:function(){this.trigger("change")}})},showOperators:!1}}},t)},_createForeignCollectionColumn:function(t){function h(t){var u=t.parent().parent().data("kendoFilterCell"),f=u.viewModel;n.extend(!0,u,{_merge:function(t){var f=this,h=t.logic||"and",e=t.filters,u,c=f.dataSource.filter()||{filters:[],logic:"and"};return e.length&&(u=e[0],u.value.length?u.expression=n.map(u.value,function(n){return i.format("{0}/{1}({2}:{2}/{3} eq '{4}')",r,"any",s,o,n[o])}).join(" "+h+" "):t.filters=[]),i.ui.FilterCell.fn._merge.call(f,t)},_parse:function(n){return n||""}})}function f(t,r,u){var h=r.field,f=r.foreign,c=f.entity||h.replace(/(\s+)?.$/,""),l=f.placeholder||i.format("选择{0}…",r.title),e=f.dataTextField||"Name",o=f.dataValueField||"Id",s=i.format("#={0} ? {1} : '<空>'#",o,e),a=f.url||"/odata/"+c,v=f.expand||"?$select=Id,Name";return u=n.extend(!0,{filter:"startswith",placeholder:l,dataTextField:e,dataValueField:o,dataSource:{type:"odata-v4",serverFiltering:!0,serverSorting:!0,transport:{read:a+v},sort:{field:e}},template:s,valueTemplate:s},u),t.kendoMultiSelect(u)}var r=t.field,u=t.foreign,s=u.entity||r.replace(/(\s+)?.$/,""),e=u.dataTextField||"Name",o=u.dataValueField||"Id",c=i.format("#=typeof({0}) != 'undefined' && {0} ? {0}.{1} : ''#",r,e);return n.extend(!0,{width:200,editor:function(i){var u=n('<input name="'+r+'" data-bind="value:'+r+'"/>').appendTo(i);f(u,t,{autoClose:!1})},template:function(t){return t[r]?n.map(t[r],function(n){return n[e]}).join(" | "):""},filterable:{ui:function(n){f(n,t)},cell:{operator:"any",template:function(n){h(n.element);f(n.element,t)},showOperators:!1}}},t)}});f.plugin(c)}(window.kendo.jQuery),window.kendo},typeof define=="function"&&define.amd?define:function(n,t){t()});